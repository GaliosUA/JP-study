<div id=deck deck_name="{{Deck}}"></div>
<!---------- Header ------------->
<header style="visibility: hidden;"></header>


<main>

<!--------- Vocab card ---------->
{{^*IsSentenceCard}}
	<div lang="ja" class="vocab">{{Expression}}</div>
	{{#Hint}}<div id="hint">{{Hint}}</div>{{/Hint}}
{{/*IsSentenceCard}}



<!------- Sentence card --------->
{{#*IsSentenceCard}}
	<div lang="ja" class="sentence-big">
		{{#Sentence (furigana)}} {{kanji:Sentence (furigana)}} {{/Sentence (furigana)}}
		{{^Sentence (furigana)}} {{kanji:Sentence}} {{/Sentence (furigana)}}
	</div>
	{{#Hint}}<div id="hint">{{Hint}}</div>{{/Hint}}
{{/*IsSentenceCard}}

</main>


<!---------- Scripts ------------>
<script>
  function addScriptToHead() {
    let head = document.getElementsByTagName('head')[0];

    // For loading japanese fonts from web
    let scriptElement = document.createElement('script');
    scriptElement.innerHTML = "(function(d) {var config = {kitId: 'uud0evt',scriptTimeout: 3000,async: true},h=d.documentElement,t=setTimeout(function(){h.className=h.className.replace(/\\bwf-loading\\b/g,'')+' wf-inactive';},config.scriptTimeout),tk=d.createElement('script'),f=false,s=d.getElementsByTagName('script')[0],a;h.className+=' wf-loading';tk.src='https://use.typekit.net/'+config.kitId+'.js';tk.async=true;tk.onload=tk.onreadystatechange=function(){a=this.readyState;if(f||a&&a!='complete'&&a!='loaded')return;f=true;clearTimeout(t);try{Typekit.load(config)}catch(e){}};s.parentNode.insertBefore(tk,s)})(document);";

    head.appendChild(scriptElement);
  }

	function isOdaka(pitchNumber) {
  	const kana = `{{kana:Expression (furigana)}}` || `{{Expression (reading)}}`;
  	return kana !== null && kana.replace(/[ャュョゃゅょ]/g, "").length === pitchNumber;
	}

	function getPitchColor(pitchPosition) {
  	const colors = {
    	heiban: "#1d9bf0",
    	atamadaka: "red",
    	nakadaka: "#f5751d",
    	odaka: "#3bd16f"
  	};
  
  	if (pitchPosition === 0) {
    	return colors.heiban;
  	} else if (pitchPosition === 1) {
    	return colors.atamadaka;
  	} else if (pitchPosition > 1) {
    	return isOdaka(pitchPosition) ? colors.odaka : colors.nakadaka;
  	}
	}

	function paintTargetWord() {
  	const pitchPositions = `{{PitchPosition}}`.match(/^\d+|\d+\b|\d+(?=\w)/g);
  	if (pitchPositions === null) return;

  	const pitchPosition = Number(pitchPositions[0]);
  	const sentences = [...document.getElementsByClassName("sentence"), ...document.getElementsByClassName("sentence-big")];
  	for (const sentence of sentences) {
    	for (const targetWord of sentence.getElementsByTagName("b")) {
      	targetWord.style.color = getPitchColor(pitchPosition);
    	}
  	}
	}

  if (navigator.userAgentData.mobile) {
    addScriptToHead();
  };
	// Uncomment this to show pitch color on front side
	// paintTargetWord()

</script>